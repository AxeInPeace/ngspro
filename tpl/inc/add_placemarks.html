<script>
ymaps.ready(init);
function init () {
    var myMap = new ymaps.Map("YMapsID", {
        center: [54.75, 37.60],
        zoom: 9,
        controls: ['zoomControl', 'rulerControl', 'geolocationControl', 'fullscreenControl', 'typeSelector']
        }, {
                searchControlProvider: 'yandex#search'
        }),
        loadingObjectManager = new ymaps.LoadingObjectManager('http://test2.enggeo.ru/map/tile/?bbox=%b', {   
            // Включаем кластеризацию.
            clusterize: true,
            // Опции кластеров задаются с префиксом cluster.
            clusterHasBalloon: true,
            // Опции объектов задаются с префиксом geoObject
            geoObjectOpenBalloonOnClick: true,
            clusterDisableClickZoom: true
        });   
 
    loadingObjectManager.objects.options.set('preset', 'islands#greenDotIcon');
    loadingObjectManager.clusters.options.set('preset', 'islands#greenClusterIcons');
    myMap.geoObjects.add(loadingObjectManager);
    
    myMap.events.add('contextmenu', function (e) {
    var coords = e.get('coords');  
    myMap.balloon.open(coords, {
     contentHeader:'Добавить материал',
     contentBody:
         '<p>Координаты щелчка: ' + [
         coords[0].toPrecision(6),
         coords[1].toPrecision(6)
         ].join(', ') + '</p>' +
         '<p><a href="#modal_material" role="button" class="btn btn-primary" data-toggle="modal">Добавить материал</a></p>' + 
         '<p><a href="#trigpoint" role="button" class="btn btn-primary" data-toggle="modal">Добавить тригапункт</a></p>',
    }); 
    
    $("#xcoord").replaceWith("<input type=\"text\" id=\"xcoord\" name=\"coord1\" value=\"" + coords[0].toPrecision(6) + "\">");
    $("#ycoord").replaceWith("<input type=\"text\" id=\"ycoord\" name=\"coord2\" value=\"" + coords[1].toPrecision(6) + "\">");
    $(".trgcoordx").attr('value', coords[0].toPrecision(6));
    $(".trgcoordy").attr('value', coords[1].toPrecision(6));
    });
    filterYear = new ymaps.control.Button({
    data: {
     content: "Отфильтровать по годам",
    },
    options: {
     selectOnClick: false,
     maxWidth: 200
         }
    });
    filterYear.events.add(
    'press',
    function () {
     $("#filteryears_form").modal('show');
    }
    )
    myMap.controls.add(filterYear, {float: 'right'});
    
    filterFormat = new ymaps.control.Button({
    data: {
     content: "Отфильтровать по format"
    },
    options: {
     selectOnClick: false,
     maxWidth: 200
         }
    });
    filterFormat.events.add(
    'press',
    function () {
    $("#filterformats_form").modal('show');
    }
    )
    myMap.controls.add(filterFormat, {float: 'right'});
}
</script>
